!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("hammerjs")):"function"==typeof define&&define.amd?define(["hammerjs"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).scaleElement=t(e.Hammer)}(this,(function(e){"use strict";return class{constructor(t,a={}){const{parentWidth:n,parentHeight:l,defaultScale:i,minScale:s,maxScale:r,limit:o,relateX:c,relateY:h}=Object.assign({parentWidth:document.body.clientWidth,parentHeight:document.body.clientHeight,defaultScale:1,minScale:0,maxScale:0,limit:!0,relateX:0,relateY:0},a);if(!t)throw new Error("cssSelector is required");if(n<=0||l<=0)throw new Error("parentWidth parentHeight 必须大于0，如果不传则取 document.body.clientWidth document.body.clientHeight");if(s<0||r<0)throw new Error("minScale and maxScale must be greater than 0");if(s>r)throw new Error("minScale must be less than maxScale");if(s>0&&r>0&&(i<s||i>r))throw new Error("defaultScale must be between minScale and maxScale");if(this._element=document.querySelector(t),!this._element)throw new Error("Element not found");console.log("init success !"),this.mc=new e.Manager(this._element),this.timer=!1,this.translateX=0,this.translateY=0,this.scale=i,this.minScale=s,this.maxScale=r,this.firstTouch=!0,this._relateX=c,this._relateY=h,this.parentWidth=n,this.parentHeight=l,this._oldX=0,this._oldY=0,this._oldScale=1,this._position=null,this._limit=o}animate(){return window[e.prefixed(window,"requestAnimationFrame")]||function(e){setTimeout(e,1e3/60)}}_setPosition(){this._element&&this._selfPosition({translateX:this._relateX,translateY:this._relateY,scale:this.scale})}_selfPosition(e){var t=this;t._animate((function(){var a=["translate3d("+e.translateX+"px,"+e.translateY+"px,0)","scale("+e.scale+","+e.scale+")"];t._element&&(t._element.style.transform=a.join(" "))}))}_animate(e){return this.animate()(e)}init(){var t=this;t.mc&&(t.mc.on("hammer.input",(function(e){e.isFinal&&(t._oldX=t.translateX,t._oldY=t.translateY,t._oldScale=t.scale)})),t.mc.add(new e.Pan({direction:e.DIRECTION_ALL,threshold:0,pointers:0})),t.mc.add(new e.Pinch({threshold:0})).recognizeWith(t.mc.get("pan")),t.mc.on("panstart panmove",(function(e){if(!t._element)return;t.firstTouch&&(t._oldX=t._relateX,t._oldY=t._relateY);t.translateX=t._oldX+e.deltaX,t.translateY=t._oldY+e.deltaY;const{width:a,height:n}=t._element.getBoundingClientRect(),l=a/t.scale/2,i=n/t.scale/2,s=l*(t.scale-1),r=t.parentWidth-a+s,o=i*(t.scale-1),c=t.parentHeight-n+o;t._limit&&(a<=t.parentWidth?(t.translateX<s&&(t.translateX=s),t.translateX>=r&&(t.translateX=r)):(t.translateX>s&&(t.translateX=s),t.translateX<r&&(t.translateX=r)),n<=t.parentHeight?(t.translateY<o&&(t.translateY=o),t.translateY>=c&&(t.translateY=c)):(t.translateY>o&&(t.translateY=o),t.translateY<c&&(t.translateY=c)));var h={translateX:t.translateX,translateY:t.translateY,scale:t.scale};t._selfPosition(h),t.firstTouch=!1})),t.mc.on("pinchstart pinchmove",(function(e){t.scale=t._oldScale*e.scale,t.maxScale>0&&t.maxScale>0&&(t.scale<t.minScale&&(t.scale=t.minScale),t.scale>t.maxScale&&(t.scale=t.maxScale));t._selfPosition({translateX:t.translateX,translateY:t.translateY,scale:t.scale}),t._selfPosition(t._position)})),t._setPosition())}resetSize(e=1){this.scale=e,this._oldScale=e,this._oldX=0,this._oldY=0,this._setPosition()}}}));
